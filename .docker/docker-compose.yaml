version: "3.9"
services:
    cmcd-server:
        container_name: cmcd-server
        image: nginx:latest
        ports:
            - "8080:8080"
        volumes:
            - ../cmcd-server/nginx/config/nginx.conf:/etc/nginx/nginx.conf:ro
            - ../cmcd-server/nginx/cmcd_njs.js:/etc/nginx/cmcd_njs.js:ro
            - ../cmcd-server/nginx/media/:/etc/nginx/media/:ro
    mongo:
        image: mongo
        ports:
            - 27017:27017
        volumes:
            - ./data/db:/data/db

    grafana:
        image: grafana/grafana
        ports:
            - 3000:3000
        environment:
            - GF_USERS_ALLOW_SIGN_UP=false
            - GF_AUTH_ANONYMOUS_ENABLED=true
            - GF_AUTH_ANONYMOUS_ORG_ROLE=Editor
        links:
            - mongo

    elasticsearch:
        image: docker.elastic.co/elasticsearch/elasticsearch:7.11.1
        environment:
            - discovery.type=single-node
        ports:
            - 9200:9200
